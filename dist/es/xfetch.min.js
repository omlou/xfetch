const t={};function e(){}function n(t,e,n,o,r,a,s,i,c){this.body=t,this.bodyUsed=e,this.headers=n,this.ok=o,this.redirected=r,this.status=a,this.statusText=s,this.type=i,this.url=c}function o(t,e){const n=e||t.type;return new Promise(((e,o)=>{switch(n){case"text/plain":case"application/json":case"":{const n=new FileReader;n.onload=()=>{const t=n.result;e({type:"text",data:t})},n.onerror=t=>{o(t)},n.readAsText(t);break}default:e({type:"file",data:t})}}))}function r(t,o){return new Promise((function(r,a){const s=new XMLHttpRequest;s.addEventListener("load",(t=>{console.log("load",t,s);const o=s.getAllResponseHeaders(),a=new n(s.response,!1,function(t){const n=new e;if(null!==t){const e=t.trim().split(/[\r\n]+/);for(const t of e){const e=t.split(": ");n.append(e[0],e[1])}}return n}(o),(i=s.status)>=200&&i<=299,!1,s.status,s.statusText,function(t){const e=/^https?:\/\/[\w-.]+(:\d+)?/i.exec(t.responseURL);return(e?e[0]:null)===window.location.origin?"basic":"cors"}(s),s.responseURL);var i;r(a)})),s.addEventListener("error",(t=>{console.log("error",t,s),a("TypeError: Failed to fetch")})),s.addEventListener("timeout",(t=>{console.log("timeout",t,s),a("TypeError: Failed to fetch")}));let i="GET";if(o&&(i=o.method?.toUpperCase()||"GET"),new Set(["GET","DELETE","HEAD","OPTIONS","TRACE"]).has(i),t instanceof Request&&(t=t.url),s.open(i,t,!0),s.responseType="blob",o){o.credentials&&"include"===o.credentials&&(s.withCredentials=!0);const{headers:t}=o;if(t)if(Array.isArray(t))for(const e of t)s.setRequestHeader(e[0],e[1]);else if(t instanceof Headers)t.forEach(((t,e)=>{s.setRequestHeader(e,t)}));else for(const e in t)s.setRequestHeader(e,t[e])}let c=null;if(o&&(c=o.body||null),c instanceof ReadableStream)throw"Body does not support ReadableStream in XMLHttpRequest.";s.send(c)}))}Object.assign(e.prototype,{get(e){let n=t[e];return void 0===n&&(n=null),n},set(e,n){t[e]=n},append(e,n){let o=t[e];t[e]=void 0===o?n:o+", "+n},delete(e){delete t[e]},has:e=>Object.prototype.hasOwnProperty.call(t,e),keys:()=>Object.keys(t)[Symbol.iterator](),values:()=>Object.values(t)[Symbol.iterator](),entries:()=>Object.keys(t).map((e=>[e,t[e]]))[Symbol.iterator](),forEach(e,n){for(let o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n?e.call(n,t[o],o,t):e(t[o],o,t))}}),Symbol&&Symbol.iterator&&(e.prototype[Symbol.iterator]=function(){return Object.keys(t).map((e=>[e,t[e]]))[Symbol.iterator]()}),Object.assign(n.prototype,{async blob(){return this.body},async arrayBuffer(){return this.body.arrayBuffer()},clone(){return this},async formData(){const t=new FormData,{type:e,data:n}=await o(this.body);if("text"===e){let e=null;try{e=JSON.parse(n);for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.append(n,e[n]);return t}catch(t){throw"Target cannot be converted to FormData."}}return t.append("file",n),t},async json(){let t=null;const{type:e,data:n}=await o(this.body);if("text"!==e)throw"Target is not json.";try{return t=JSON.parse(n),t}catch(t){throw"Target is not json."}},async text(){const{data:t}=await o(this.body,"text/plain");return t}});const a={json:"application/json;charset=UTF-8",urlencoded:"application/x-www-form-urlencoded;charset=UTF-8",formData:"multipart/form-data",text:"text/plain;charset=UTF-8",xml:"application/xml;charset=UTF-8",stream:"application/octet-stream"};function s(t,e=!1){const n=[];for(const e in t)t.hasOwnProperty(e)&&(null===t[e]||void 0===t[e]?t[e]="":t[e]=String(t[e]),n.push(encodeURIComponent(e)+"="+encodeURIComponent(t[e])));const o=n.join("&");return o&&e?"?"+o:o}function i(t,e){let n=t.indexOf("#"),o="",r="";return-1===n?o=t:(o=t.substring(0,n),r=t.substring(n)),o+=o.includes("?")?"&"+e:"?"+e,o+r}function c(t){if(!t)return null;if(Array.isArray(t)){for(let e of t)if("content-type"===e[0].toLowerCase())return e[1];return null}if(t instanceof Headers)return t.get("content-type");for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){if("content-type"===e.toLowerCase())return t[e]}return null}function l(t,e){Array.isArray(t)?t.push(["Content-Type",e]):t instanceof Headers?t.set("Content-Type",e):t["Content-Type"]=e}function p(t,e){const n=(window.fetch||(window.fetch=r),window.fetch);if(!e)return n(t);const{query:o,data:p,contentType:d,responseType:u}=e;if(!(t instanceof Request)&&o){const e=s(o);e&&(t="string"==typeof t?i(t,e):new URL(i(t.href,e)))}let{headers:f}=e;d&&(f?c(f)||l(f,a[d]):e.headers={"Content-Type":a[d]});const{body:y}=e;if(f=e.headers,p&&!y){const t=c(f);let n=p;if("string"!=typeof p)if(t){if(t.includes("application/json"))try{n=JSON.stringify(p)}catch(t){console.warn('Failed to convert "data" to JSON string.')}else if(t.includes("application/x-www-form-urlencoded"))try{n=s(p)}catch(t){console.warn('Failed to convert "data" to urlencoded string.')}else if(t.includes("multipart/form-data")&&!(p instanceof FormData))try{const t=new FormData;for(const e in p)Object.prototype.hasOwnProperty.call(p,e)&&t.append(e,p[e]);n=t}catch(t){console.warn('Failed to convert "data" to FormData.')}}else try{n=JSON.stringify(p),f?l(f,"application/json;charset=UTF-8"):e.headers={"Content-Type":"application/json;charset=UTF-8"}}catch(t){}e.body=n}return u?new Promise((function(o,r){n(t,e).then((t=>{t.clone()[u]().then((e=>{t[u+"Sync"]=e,o(t)})).catch((()=>{o(t)}))})).catch((t=>{r(t)}))})):n(t,e)}export{n as XHRFetchResponse,e as XHRHeaders,p as default,s as queryString,r as xhrFetch};
//# sourceMappingURL=xfetch.min.js.map
